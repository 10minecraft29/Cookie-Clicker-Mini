<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cookie Clicker Mini</title>
<style>
  /* Basic polished UI (same as before) */
  body { font-family: 'Segoe UI', sans-serif; margin:0; background: linear-gradient(to bottom,#6dd5ed,#2193b0); color:#fff; overflow-x:hidden; }
  header { position: sticky; top:0; background: rgba(0,0,0,0.4); padding:12px; font-size:22px; text-align:center; font-weight:700; z-index:10; }
  #gameArea { display:flex; justify-content:space-around; flex-wrap:wrap; padding:18px; gap:18px; }
  #clickArea { flex:1; min-width:260px; text-align:center; }
  .click-button { font-size:26px; padding:18px 36px; border:none; border-radius:48px; background:#ff9800; color:#fff; cursor:pointer; transition:transform .08s; }
  .click-button:active { transform:scale(.98); }
  #info { margin-top:12px; font-size:16px; }
  #prestigeInfo { margin-top:10px; font-size:16px; font-weight:600; }
  #gameButtons { margin-top:14px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
  #gameButtons button { padding:8px 14px; border-radius:8px; border:none; cursor:pointer; }
  #watchAdBtn, #prestigeBtn { background:#d2691e; color:#fff; }
  #shop { flex:1; min-width:320px; display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:14px; }
  .shop-item { background:rgba(255,255,255,0.08); border-radius:12px; padding:12px; text-align:center; transition:background .15s; box-shadow:0 2px 8px rgba(0,0,0,.15); }
  .shop-item.affordable { background: rgba(0,255,0,0.12); }
  .shop-item h3 { margin:0 0 6px 0; font-size:16px; }
  .shop-item p { margin:6px 0; font-size:13px; color:#f0f0f0; }
  .shop-item button { margin-top:6px; width:100%; padding:6px; border-radius:8px; border:none; background:#00bcd4; color:white; cursor:pointer; }
  .float-text { position:absolute; font-size:18px; color:yellow; font-weight:700; animation: floatUp 1s ease-out forwards; pointer-events:none; text-shadow:0 1px 2px rgba(0,0,0,.5); }
  @keyframes floatUp { 0% { opacity:1; transform:translateY(0); } 100% { opacity:0; transform:translateY(-60px); } }

  .golden-cookie { position:absolute; width:50px; height:50px; background:gold; border-radius:50%; border:3px solid #daa520; cursor:pointer; box-shadow:0 0 15px rgba(255,215,0,.8); display:flex; align-items:center; justify-content:center; font-weight:900; color:#5a3100; }
  .mega-cookie { width:84px !important; height:84px !important; font-size:20px; background:orange !important; box-shadow:0 0 30px rgba(255,140,0,.95) !important; }

  /* Admin */
  #adminBtn { position:fixed; bottom:10px; right:10px; background:rgba(0,0,0,.55); color:#fff; padding:8px 10px; border-radius:8px; font-size:12px; cursor:pointer; z-index:9999; }
  #adminPanel { display:none; position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,.9); padding:16px; border-radius:12px; width:320px; z-index:10000; }
  #adminPanel h3 { margin:0 0 8px 0; font-size:18px; text-align:center; }
  #adminPanel button { display:block; width:100%; margin:8px 0; padding:8px; border-radius:8px; border:none; background:#00bcd4; color:white; cursor:pointer; }
  #wipeBtn { background:red !important; animation:flash 1s infinite; }
  @keyframes flash { 0%,100% { background:red; } 50% { background:darkred; } }

  /* small status area */
  #statusBar { position:fixed; left:10px; bottom:10px; background:rgba(0,0,0,0.45); color:#fff; padding:8px 10px; border-radius:8px; font-size:13px; z-index:9999; }
</style>
</head>
<body>

<header id="score">Score: 0</header>

<div id="gameArea">
  <div id="clickArea">
    <button class="click-button" id="clickBtn">Click Me!</button>
    <div id="info">Points per click: 1 | Points per second: 0</div>
    <div id="prestigeInfo">Prestige Points: 0 | Multiplier: 1.00x</div>
    <div id="gameButtons">
      <button id="prestigeBtn">Prestige Reset</button>
    </div>
  </div>

  <div id="shop"></div>
</div>

<!-- Admin -->
<div id="adminBtn">Admin</div>
<div id="adminPanel" aria-hidden="true">
  <h3>Admin Panel</h3>
  <button id="addScoreBtn">+10,000 Score</button>
  <button id="addPrestigeBtn">+10 Prestige</button>
  <button id="unlockAllBtn">Unlock All Items</button>
  <button id="spawnCookieBtn">Spawn Golden Cookie</button>
  <button id="spawnMegaCookieBtn">Spawn Mega Golden Cookie</button>
  <button id="toggleLagBtn">Toggle Lag (OFF)</button>
  <button id="wipeBtn">Wipe Save / Reset Game</button>
  <button id="closeAdminBtn">Close</button>
</div>

<div id="statusBar">Autosave: idle</div>

<script>
/* ===========================
   Game variables & settings
   =========================== */
let score = 0;
let basePointsPerClick = 1;
let prestigePoints = 0;
let prestigeMultiplier = 1;
let pointsPerClick = basePointsPerClick * prestigeMultiplier;
const prestigeThreshold = 1000000;

let lagEnabled = false; // admin-toggleable "moderate lag" mode

// Expanded shop up to Antimatter Condenser
let shopItems = [
  { name:"Cursor", baseCost:15, cost:15, amount:0, cps:0.1 },
  { name:"Grandma", baseCost:100, cost:100, amount:0, cps:1 },
  { name:"Farm", baseCost:500, cost:500, amount:0, cps:5 },
  { name:"Factory", baseCost:2000, cost:2000, amount:0, cps:20 },
  { name:"Bank", baseCost:10000, cost:10000, amount:0, cps:100 },
  { name:"Mine", baseCost:50000, cost:50000, amount:0, cps:500 },
  { name:"Temple", baseCost:200000, cost:200000, amount:0, cps:2000 },
  { name:"Wizard Tower", baseCost:1000000, cost:1000000, amount:0, cps:10000 },
  { name:"Portal", baseCost:10000000, cost:10000000, amount:0, cps:100000 },
  { name:"Time Machine", baseCost:50000000, cost:50000000, amount:0, cps:500000 },
  { name:"Antimatter Condenser", baseCost:250000000, cost:250000000, amount:0, cps:2500000 }
];

/* ===========================
   DOM references
   =========================== */
const scoreEl = document.getElementById('score');
const infoEl = document.getElementById('info');
const prestigeEl = document.getElementById('prestigeInfo');
const shopEl = document.getElementById('shop');
const clickBtn = document.getElementById('clickBtn');
const prestigeBtn = document.getElementById('prestigeBtn');

const adminBtn = document.getElementById('adminBtn');
const adminPanel = document.getElementById('adminPanel');
const addScoreBtn = document.getElementById('addScoreBtn');
const addPrestigeBtn = document.getElementById('addPrestigeBtn');
const unlockAllBtn = document.getElementById('unlockAllBtn');
const spawnCookieBtn = document.getElementById('spawnCookieBtn');
const spawnMegaCookieBtn = document.getElementById('spawnMegaCookieBtn');
const toggleLagBtn = document.getElementById('toggleLagBtn');
const wipeBtn = document.getElementById('wipeBtn');
const closeAdminBtn = document.getElementById('closeAdminBtn');

const statusBar = document.getElementById('statusBar');

/* ===========================
   Save / Load (autosave)
   =========================== */
function saveGame(){
  try {
    localStorage.setItem('clickerSave_v2', JSON.stringify({
      score, basePointsPerClick, prestigePoints, shopItems
    }));
    statusBar.innerText = 'Autosave: saved ' + new Date().toLocaleTimeString();
  } catch(e){
    console.warn('Save failed', e);
    statusBar.innerText = 'Autosave: failed';
  }
}
function loadGame(){
  const data = JSON.parse(localStorage.getItem('clickerSave_v2') || 'null');
  if(data){
    score = data.score || 0;
    basePointsPerClick = data.basePointsPerClick || 1;
    prestigePoints = data.prestigePoints || 0;
    shopItems = data.shopItems || shopItems;
  }
  updateFromPrestige();
}

/* ===========================
   Update & render
   =========================== */
function updateFromPrestige(){
  prestigeMultiplier = 1 + prestigePoints * 0.05;
  pointsPerClick = basePointsPerClick * prestigeMultiplier;
}
function updateDisplay(){
  const pps = shopItems.reduce((s,i)=> s + i.cps * i.amount, 0) * prestigeMultiplier;
  scoreEl.innerText = 'Score: ' + Math.floor(score);
  infoEl.innerText = `Points per click: ${pointsPerClick.toFixed(1)} | Points per second: ${pps.toFixed(1)}`;
  prestigeEl.innerText = `Prestige Points: ${prestigePoints} | Multiplier: ${prestigeMultiplier.toFixed(2)}x`;
  prestigeBtn.style.display = score >= prestigeThreshold ? 'inline-block' : 'none';
  renderShop(); // intentionally called often (inefficiently when lag on)
}

/* renderShop intentionally inefficient when lag on */
function renderShop(){
  // Naive rebuild of full shop DOM each call
  shopEl.innerHTML = '';
  for(let i=0;i<shopItems.length;i++){
    const it = shopItems[i];
    const container = document.createElement('div');
    container.className = 'shop-item' + (score >= it.cost ? ' affordable' : '');
    // force string concatenation and innerHTML
    container.innerHTML = '<h3>' + it.name + '</h3>' +
                          '<p>Owned: ' + it.amount + '</p>' +
                          '<p>Cost: ' + Math.floor(it.cost) + '</p>' +
                          '<p>CPS: ' + it.cps + '</p>' +
                          '<button data-idx="' + i + '">Buy</button>';
    shopEl.appendChild(container);
    // attach click handler (inefficient per-button binding)
    const btn = container.querySelector('button');
    btn.addEventListener('click', function(){ buyItem(parseInt(this.dataset.idx)); });
  }
}

/* ===========================
   Core game actions
   =========================== */
function buyItem(index){
  const item = shopItems[index];
  if(score >= item.cost){
    score -= item.cost;
    item.amount++;
    item.cost = Math.floor(item.baseCost * Math.pow(1.15, item.amount));
    updateDisplay();
  } else {
    // slight intentional delay when trying to buy without money
    for(let k=0;k<10000;k++) { Math.sqrt(k); }
  }
}

clickBtn.addEventListener('click', function(e){
  // normal reward
  score += pointsPerClick;
  createFloatingText('+' + pointsPerClick.toFixed(1), e.clientX, e.clientY);

  // extra small inefficient loop to add lag when enabled
  if(lagEnabled){
    // do a short busy loop that's moderately heavy
    let s = 0;
    for(let i=0;i<12000;i++){ s += Math.sqrt(i) % 13; }
    // create and immediately remove a dummy invisible element (DOM churn)
    const temp = document.createElement('div');
    temp.style.position = 'absolute';
    temp.style.left = '-9999px';
    temp.innerText = s;
    document.body.appendChild(temp);
    // force layout thrash
    void temp.offsetHeight;
    temp.remove();
  }

  updateDisplay();
});

prestigeBtn.addEventListener('click', function(){
  if(score >= prestigeThreshold){
    const gained = Math.floor(score / prestigeThreshold);
    prestigePoints += gained;
    score = 0;
    basePointsPerClick = 1;
    shopItems.forEach(it => { it.amount = 0; it.cost = it.baseCost; });
    updateFromPrestige();
    updateDisplay();
  }
});

/* ===========================
   Floating text utility
   =========================== */
function createFloatingText(text, x, y){
  const el = document.createElement('div');
  el.className = 'float-text';
  el.style.left = (x - 20) + 'px';
  el.style.top = (y - 20) + 'px';
  el.innerText = text;
  document.body.appendChild(el);
  setTimeout(()=> el.remove(), 900);
}

/* ===========================
   Golden cookie logic
   =========================== */
function spawnGoldenCookie(mega=false){
  const gc = document.createElement('div');
  gc.className = 'golden-cookie' + (mega ? ' mega-cookie' : '');
  gc.innerText = '★';
  let x = Math.random() * (window.innerWidth - 120) + 20;
  let y = Math.random() * (window.innerHeight - 240) + 80;
  gc.style.left = x + 'px';
  gc.style.top = y + 'px';
  document.body.appendChild(gc);

  gc.addEventListener('click', function(){
    let bonus = Math.max(100, pointsPerClick * 5);
    if(mega) bonus *= 10;
    score += bonus;
    createFloatingText('+' + Math.floor(bonus) + (mega ? ' MEGA!' : ''), x+20, y+10);
    gc.remove();
    updateDisplay();
  });

  // remove after 5s
  setTimeout(()=> { if(document.body.contains(gc)) gc.remove(); }, 5000);
}

/* ===========================
   Admin panel & controls
   =========================== */
adminBtn.addEventListener('click', adminLogin);
function adminLogin(){
  const pass = prompt('Enter admin password:');
  if(pass === '80231021'){
    adminPanel.style.display = 'block';
    adminPanel.setAttribute('aria-hidden', 'false');
  } else {
    alert('Incorrect password.');
  }
}
closeAdminBtn.addEventListener('click', function(){
  adminPanel.style.display = 'none';
  adminPanel.setAttribute('aria-hidden', 'true');
});

addScoreBtn.addEventListener('click', function(){ score += 10000; updateDisplay(); });
addPrestigeBtn.addEventListener('click', function(){ prestigePoints += 10; updateFromPrestige(); updateDisplay(); });
unlockAllBtn.addEventListener('click', function(){ shopItems.forEach(it => it.amount = 10); updateDisplay(); });
spawnCookieBtn.addEventListener('click', function(){ spawnGoldenCookie(false); });
spawnMegaCookieBtn.addEventListener('click', function(){ spawnGoldenCookie(true); });

toggleLagBtn.addEventListener('click', function(){
  lagEnabled = !lagEnabled;
  toggleLagBtn.innerText = 'Toggle Lag (' + (lagEnabled ? 'ON' : 'OFF') + ')';
  // when turning on, kick off the lag routines
  if(lagEnabled){
    startLagRoutines();
  } else {
    stopLagRoutines();
  }
});

/* Wipe save */
wipeBtn.addEventListener('click', function(){
  if(confirm('Are you sure? This will wipe saved progress.')){
    localStorage.removeItem('clickerSave_v2');
    location.reload();
  }
});

/* ===========================
   Autosave & load initialization
   =========================== */
loadGame();
updateFromPrestige();
updateDisplay();
setInterval(saveGame, 5000); // autosave every 5 seconds

/* ===========================
   Game loops and moderate lag routines
   =========================== */

// Standard income tick: runs frequently
const tickInterval = 100; // 10 ticks per second
let mainTick = setInterval(function(){
  // base gain scaled by cps and prestige
  const cps = shopItems.reduce((s,i) => s + i.cps * i.amount, 0) * prestigeMultiplier;
  score += cps * (tickInterval/1000);
  // intentionally inefficient: if lag enabled, perform extra math + DOM churn
  if(lagEnabled){
    // heavy-ish math chunk
    let acc = 0;
    for(let i=0;i<7000;i++){ acc += Math.sin(i) * Math.sqrt(i); }
    // create and remove a hidden element to thrash the DOM
    const d = document.createElement('div');
    d.style.position = 'absolute'; d.style.left = '-9999px';
    d.innerText = acc.toFixed(2);
    document.body.appendChild(d);
    // force layout measurement (layout thrash)
    void d.clientHeight;
    d.remove();
  }
  updateDisplay();
}, tickInterval);

// random golden cookie spawn (keeps same)
setInterval(function(){
  if(Math.random() < 0.12) spawnGoldenCookie(false);
}, 10000);

// Moderate additional lag routines (start/stop via admin)
let lagIntervalHandles = [], domChurnHandle = null, cpuSpinHandle = null;

function startLagRoutines(){
  // interval that rebuilds the shop excessively often
  lagIntervalHandles.push(setInterval(function(){
    // rebuild shop double times (wasteful)
    renderShop();
    renderShop();
  }, 700));

  // interval that creates invisible elements and removes them
  domChurnHandle = setInterval(function(){
    for(let i=0;i<6;i++){
      const el = document.createElement('div');
      el.style.position = 'absolute';
      el.style.left = '-9999px';
      el.innerText = Math.random().toFixed(6);
      document.body.appendChild(el);
      // immediate read to force layout
      void el.offsetWidth;
      el.remove();
    }
  }, 500);

  // cpu spin loop in interval to add moderate CPU load
  cpuSpinHandle = setInterval(function(){
    let s=0;
    for(let i=0;i<150000;i++){ s += Math.log(i+1) % 3; }
    // use s in a dummy way
    if(s > 0 && Math.random() < 0.000001) console.log('rare');
  }, 1200);
}

function stopLagRoutines(){
  lagIntervalHandles.forEach(h => clearInterval(h));
  lagIntervalHandles = [];
  if(domChurnHandle){ clearInterval(domChurnHandle); domChurnHandle = null; }
  if(cpuSpinHandle){ clearInterval(cpuSpinHandle); cpuSpinHandle = null; }
}

/* ===========================
   Extra: keyboard shortcut to toggle lag (Admin-only)
   =========================== */
document.addEventListener('keydown', function(e){
  // ctrl+shift+l toggles lag (convenience)
  if(e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'l'){
    // require admin panel open for shortcut to work (safety)
    if(adminPanel.style.display === 'block'){
      lagEnabled = !lagEnabled;
      toggleLagBtn.innerText = 'Toggle Lag (' + (lagEnabled ? 'ON' : 'OFF') + ')';
      if(lagEnabled) startLagRoutines(); else stopLagRoutines();
      alert('Lag toggled: ' + (lagEnabled ? 'ON' : 'OFF'));
    }
  }
});

/* End of file */
</script>
</body>
</html>

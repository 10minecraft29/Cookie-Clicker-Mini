<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cookie Clicker Mini</title>
<style>
  body { font-family: 'Segoe UI', Tahoma, sans-serif; margin:0; background: linear-gradient(to bottom,#6dd5ed,#2193b0); color:#fff; overflow-x:hidden; }
  header { position: sticky; top:0; background: rgba(0,0,0,0.45); padding:12px; font-size:20px; text-align:center; font-weight:700; z-index:10; }
  #gameArea { display:flex; justify-content:space-around; flex-wrap:wrap; padding:18px; gap:18px; }
  #clickArea { flex:1; min-width:260px; text-align:center; }
  .click-button { font-size:24px; padding:16px 32px; border:none; border-radius:40px; background:#ff9800; color:#fff; cursor:pointer; transition:transform .08s; }
  .click-button:active { transform:scale(.98); }
  #info { margin-top:10px; font-size:15px; }
  #prestigeInfo { margin-top:8px; font-size:15px; font-weight:600; }
  #gameButtons { margin-top:12px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
  #prestigeBtn { background:#d2691e; color:#fff; padding:8px 12px; border-radius:8px; border:none; }
  #shop { flex:1; min-width:320px; display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:12px; }
  .shop-item { background:rgba(255,255,255,0.08); border-radius:10px; padding:10px; text-align:center; transition:background .12s; box-shadow:0 2px 6px rgba(0,0,0,.15); }
  .shop-item.affordable { background: rgba(0,255,0,0.12); }
  .shop-item h3 { margin:0 0 6px 0; font-size:15px; }
  .shop-item p { margin:6px 0; font-size:13px; color:#f0f0f0; }
  .shop-item button { margin-top:6px; width:100%; padding:6px; border-radius:8px; border:none; background:#00bcd4; color:white; cursor:pointer; }
  .float-text { position:absolute; font-size:16px; color:yellow; font-weight:700; animation: floatUp 1s ease-out forwards; pointer-events:none; text-shadow:0 1px 2px rgba(0,0,0,.5); }
  @keyframes floatUp { 0% { opacity:1; transform:translateY(0);} 100% { opacity:0; transform:translateY(-60px);} }
  .golden-cookie { position:absolute; width:48px; height:48px; background:gold; border-radius:50%; border:3px solid #daa520; cursor:pointer; box-shadow:0 0 12px rgba(255,215,0,.85); display:flex; align-items:center; justify-content:center; font-weight:900; color:#5a3100; }
  .mega-cookie { width:84px !important; height:84px !important; font-size:20px; background:orange !important; box-shadow:0 0 30px rgba(255,140,0,.95) !important; }
  #adminBtn { position:fixed; bottom:10px; right:10px; background:rgba(0,0,0,.55); color:#fff; padding:8px 10px; border-radius:8px; font-size:12px; cursor:pointer; z-index:9999; }
  #adminPanel { display:none; position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,.94); padding:14px; border-radius:12px; width:360px; z-index:10000; }
  #adminPanel h3 { margin:0 0 10px 0; font-size:18px; text-align:center; }
  #adminPanel button { display:block; width:100%; margin:8px 0; padding:8px; border-radius:8px; border:none; background:#00bcd4; color:white; cursor:pointer; }
  #wipeBtn { background:red !important; animation:flash 1s infinite; }
  @keyframes flash { 0%,100% { background:red; } 50% { background:darkred; } }
  #statusBar { position:fixed; left:10px; bottom:10px; background:rgba(0,0,0,0.45); color:#fff; padding:8px 10px; border-radius:8px; font-size:13px; z-index:9999; max-width:40vw; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
</style>
</head>
<body>
<header id="score">Cookie Clicker Mini — Score: 0</header>

<div id="gameArea">
  <div id="clickArea">
    <button class="click-button" id="clickBtn">Click Me!</button>
    <div id="info">Points per click: 1 | Points per second: 0</div>
    <div id="prestigeInfo">Prestige Points: 0 | Multiplier: 1.00x</div>
    <div id="gameButtons">
      <button id="prestigeBtn">Prestige Reset</button>
    </div>
  </div>

  <div id="shop"></div>
</div>

<div id="adminBtn">Admin</div>
<div id="adminPanel" aria-hidden="true">
  <h3>Admin Panel</h3>
  <button id="addScoreBtn">+10,000 Score</button>
  <button id="addPrestigeBtn">+10 Prestige</button>
  <button id="unlockAllBtn">Unlock All Items</button>
  <button id="spawnCookieBtn">Spawn Golden Cookie</button>
  <button id="spawnMegaCookieBtn">Spawn Mega Golden Cookie</button>
  <!-- lag is permanent; Toggle Lag removed -->
  <button id="wipeBtn">Wipe Save / Reset Game</button>
  <button id="closeAdminBtn">Close</button>
</div>

<div id="statusBar">Autosave: idle — WARNING: PERMANENT HEAVY LAG ENABLED</div>

<script>
/* ======================
   Core game state
   ====================== */
let score = 0;
let basePointsPerClick = 1;
let prestigePoints = 0;
let prestigeMultiplier = 1;
let pointsPerClick = basePointsPerClick * prestigeMultiplier;
const prestigeThreshold = 1000000;

/* purposely heavy/malicious-looking memory container */
let massiveMemory = []; // will grow large on purpose

const shopItems = [
  { name:"Cursor", baseCost:15, cost:15, amount:0, cps:0.1 },
  { name:"Grandma", baseCost:100, cost:100, amount:0, cps:1 },
  { name:"Farm", baseCost:500, cost:500, amount:0, cps:5 },
  { name:"Factory", baseCost:2000, cost:2000, amount:0, cps:20 },
  { name:"Bank", baseCost:10000, cost:10000, amount:0, cps:100 },
  { name:"Mine", baseCost:50000, cost:50000, amount:0, cps:500 },
  { name:"Temple", baseCost:200000, cost:200000, amount:0, cps:2000 },
  { name:"Wizard Tower", baseCost:1000000, cost:1000000, amount:0, cps:10000 },
  { name:"Portal", baseCost:10000000, cost:10000000, amount:0, cps:100000 },
  { name:"Time Machine", baseCost:50000000, cost:50000000, amount:0, cps:500000 },
  { name:"Antimatter Condenser", baseCost:250000000, cost:250000000, amount:0, cps:2500000 }
];

/* DOM refs */
const scoreHeader = document.getElementById('score');
const infoEl = document.getElementById('info');
const prestigeEl = document.getElementById('prestigeInfo');
const shopEl = document.getElementById('shop');
const clickBtn = document.getElementById('clickBtn');
const prestigeBtn = document.getElementById('prestigeBtn');
const statusBar = document.getElementById('statusBar');

const adminBtn = document.getElementById('adminBtn');
const adminPanel = document.getElementById('adminPanel');
const addScoreBtn = document.getElementById('addScoreBtn');
const addPrestigeBtn = document.getElementById('addPrestigeBtn');
const unlockAllBtn = document.getElementById('unlockAllBtn');
const spawnCookieBtn = document.getElementById('spawnCookieBtn');
const spawnMegaCookieBtn = document.getElementById('spawnMegaCookieBtn');
const wipeBtn = document.getElementById('wipeBtn');
const closeAdminBtn = document.getElementById('closeAdminBtn');

/* ======================
   Save / Load (autosave)
   ====================== */
function saveGame(){
  try {
    localStorage.setItem('ccm_perma_lag_save', JSON.stringify({
      score, basePointsPerClick, prestigePoints, shopItems
    }));
    statusBar.innerText = 'Autosave: saved ' + new Date().toLocaleTimeString() + ' — PERMANENT LAG';
  } catch(e){
    statusBar.innerText = 'Autosave: failed';
    console.warn('Save failed', e);
  }
}
function loadGame(){
  try {
    const d = JSON.parse(localStorage.getItem('ccm_perma_lag_save') || 'null');
    if(d){
      score = d.score || 0;
      basePointsPerClick = d.basePointsPerClick || 1;
      prestigePoints = d.prestigePoints || 0;
      if(d.shopItems && Array.isArray(d.shopItems)){
        for(let i=0;i<shopItems.length;i++){
          if(d.shopItems[i]) {
            shopItems[i].amount = d.shopItems[i].amount || 0;
            shopItems[i].cost = d.shopItems[i].cost || shopItems[i].baseCost;
          }
        }
      }
    }
  } catch(e){
    console.warn('Load failed', e);
  }
  updateFromPrestige();
}

/* ======================
   UI rendering
   ====================== */
function updateFromPrestige(){
  prestigeMultiplier = 1 + (prestigePoints * 0.05);
  pointsPerClick = basePointsPerClick * prestigeMultiplier;
}
function updateDisplay(){
  const pps = shopItems.reduce((s,i)=> s + i.cps * i.amount, 0) * prestigeMultiplier;
  scoreHeader.innerText = `Cookie Clicker Mini — Score: ${Math.floor(score)}`;
  infoEl.innerText = `Points per click: ${pointsPerClick.toFixed(1)} | Points per second: ${pps.toFixed(1)}`;
  prestigeEl.innerText = `Prestige Points: ${prestigePoints} | Multiplier: ${prestigeMultiplier.toFixed(2)}x`;
  prestigeBtn.style.display = score >= prestigeThreshold ? 'inline-block' : 'none';
  renderShop(); // deliberately expensive
}

/* naive shop rebuild every update */
function renderShop(){
  shopEl.innerHTML = '';
  for(let i=0;i<shopItems.length;i++){
    const it = shopItems[i];
    const card = document.createElement('div');
    card.className = 'shop-item' + (score >= it.cost ? ' affordable' : '');
    card.innerHTML = '<h3>' + it.name + '</h3>' +
                     '<p>Owned: ' + it.amount + '</p>' +
                     '<p>Cost: ' + Math.floor(it.cost) + '</p>' +
                     '<p>CPS: ' + it.cps + '</p>' +
                     '<button data-idx="' + i + '">Buy</button>';
    shopEl.appendChild(card);
    card.querySelector('button').addEventListener('click', function(){ buyItem(parseInt(this.dataset.idx)); });
  }
}

/* ======================
   Actions
   ====================== */
function buyItem(idx){
  const it = shopItems[idx];
  if(score >= it.cost){
    score -= it.cost;
    it.amount++;
    it.cost = Math.floor(it.baseCost * Math.pow(1.15, it.amount));
    updateDisplay();
  } else {
    // small busy work
    for(let i=0;i<20000;i++) Math.sqrt(i);
  }
}

/* click handling — includes heavy synchronous work to ensure permanent lag */
clickBtn.addEventListener('click', function(e){
  score += pointsPerClick;
  createFloatingText('+' + pointsPerClick.toFixed(1), e.clientX, e.clientY);

  // heavy synchronous CPU & DOM workload (per click)
  // large math loop
  let acc = 0;
  for(let i=0;i<2000000;i++){ acc += Math.sin(i) * Math.log(i+1); }
  // create many hidden nodes and thrash layout
  for(let k=0;k<200;k++){
    const tmp = document.createElement('div');
    tmp.style.position='absolute'; tmp.style.left='-9999px'; tmp.textContent = acc.toFixed(2) + Math.random().toFixed(6);
    document.body.appendChild(tmp);
    void tmp.offsetHeight;
    tmp.remove();
  }
  // bloat memory massively (but keep bounded-ish to avoid immediate OOM)
  for(let m=0;m<5000;m++){
    massiveMemory.push(new Array(100).fill(Math.random()));
  }
  if(massiveMemory.length > 500000) massiveMemory.splice(0, massiveMemory.length - 300000);

  updateDisplay();
});

/* prestige */
prestigeBtn.addEventListener('click', function(){
  if(score >= prestigeThreshold){
    const gained = Math.floor(score / prestigeThreshold);
    prestigePoints += gained;
    score = 0;
    basePointsPerClick = 1;
    for(let it of shopItems){ it.amount = 0; it.cost = it.baseCost; }
    updateFromPrestige();
    updateDisplay();
  }
});

/* floating text */
function createFloatingText(text,x,y){
  const el = document.createElement('div');
  el.className = 'float-text';
  el.style.left = (x - 20) + 'px';
  el.style.top = (y - 20) + 'px';
  el.textContent = text;
  document.body.appendChild(el);
  setTimeout(()=> el.remove(), 900);
}

/* spawn golden cookie */
function spawnGoldenCookie(mega=false){
  const gc = document.createElement('div');
  gc.className = 'golden-cookie' + (mega ? ' mega-cookie' : '');
  gc.textContent = '★';
  const x = Math.random() * (window.innerWidth - 160) + 20;
  const y = Math.random() * (window.innerHeight - 280) + 80;
  gc.style.left = x + 'px';
  gc.style.top = y + 'px';
  document.body.appendChild(gc);

  gc.addEventListener('click', function(){
    let bonus = Math.max(100, pointsPerClick * 5);
    if(mega) bonus *= 10;
    score += bonus;
    createFloatingText('+' + Math.floor(bonus) + (mega ? ' MEGA!' : ''), x+20, y+10);
    gc.remove();
    updateDisplay();
  });

  setTimeout(()=> { if(document.body.contains(gc)) gc.remove(); }, 5000);
}

/* ======================
   Admin Panel wiring
   ====================== */
adminBtn.addEventListener('click', adminLogin);
function adminLogin(){
  const pass = prompt('Enter admin password:');
  if(pass === '80231021'){
    adminPanel.style.display = 'block';
    adminPanel.setAttribute('aria-hidden','false');
  } else {
    alert('Incorrect password.');
  }
}
closeAdminBtn.addEventListener('click', function(){
  adminPanel.style.display = 'none';
  adminPanel.setAttribute('aria-hidden','true');
});

addScoreBtn.addEventListener('click', function(){ score += 10000; updateDisplay(); });
addPrestigeBtn.addEventListener('click', function(){ prestigePoints += 10; updateFromPrestige(); updateDisplay(); });
unlockAllBtn.addEventListener('click', function(){ for(let it of shopItems) it.amount = 10; updateDisplay(); });
spawnCookieBtn.addEventListener('click', function(){ spawnGoldenCookie(false); });
spawnMegaCookieBtn.addEventListener('click', function(){ spawnGoldenCookie(true); });
wipeBtn.addEventListener('click', function(){ if(confirm('Wipe all progress?')){ localStorage.removeItem('ccm_perma_lag_save'); location.reload(); } });

/* ======================
   Permanent heavy lag routines (start immediately)
   ====================== */

/* 1) Extremely heavy periodic CPU loop (runs often) */
setInterval(function heavyCpuTick(){
  // enormous CPU loop to throttle frame rate; intensity tuned for 5-10 FPS on many machines
  let s = 0;
  for(let i=0;i<4_000_000;i++){
    // cheap-ish math but many iterations
    s += Math.sqrt(i) % 7;
    if(i % 1000000 === 0) { /* micro-yield point */ }
  }
  // waste the result into a short-lived DOM node to force layout
  const n = document.createElement('div');
  n.style.position='absolute'; n.style.left='-9999px';
  n.textContent = s.toFixed(2);
  document.body.appendChild(n);
  void n.offsetWidth;
  n.remove();

  // bloat memory on each tick, trimmed to a massive size
  for(let j=0;j<2000;j++) massiveMemory.push(new Array(30).fill(Math.random()));
  if(massiveMemory.length > 1_200_000) massiveMemory.splice(0, massiveMemory.length - 800_000);

}, 300); // every 300ms — heavy but periodic

/* 2) Massive DOM churn: create & remove many nodes rapidly */
setInterval(function domChurn(){
  // create many nodes quickly
  const frag = document.createDocumentFragment();
  for(let i=0;i<1200;i++){
    const d = document.createElement('div');
    d.style.position='absolute'; d.style.left='-9999px';
    d.textContent = Math.random().toFixed(8);
    frag.appendChild(d);
  }
  document.body.appendChild(frag);
  // read layout forcing reflow
  const h = document.body.offsetHeight;
  // remove them
  for(let k=0;k<1200;k++){
    if(document.body.lastChild) document.body.removeChild(document.body.lastChild);
  }
  // also trigger a style thrash
  document.body.style.transform = 'translateZ(0) scale(' + (1 + Math.random() * 0.0001) + ')';
}, 700);

/* 3) Layout thrash: toggle class/styles repeatedly */
setInterval(function thrash(){
  for(let i=0;i<80;i++){
    document.body.style.marginLeft = (i % 2 === 0 ? '0px' : '1px');
    void document.body.offsetLeft;
  }
}, 500);

/* 4) Frequent shop rebuilds (inefficient) */
setInterval(function rebuildShopFrequently(){
  renderShop();
}, 400);

/* 5) Income tick (still works but will be slow) */
setInterval(function incomeTick(){
  const cps = shopItems.reduce((s,i) => s + i.cps * i.amount, 0) * prestigeMultiplier;
  score += cps * 0.25; // quarter-second equivalent increment (but timing hits by heavy loops)
  updateDisplay();
}, 250);

/* 6) Random golden cookie spawns often */
setInterval(function(){
  if(Math.random() < 0.2) spawnGoldenCookie(false);
}, 8000);

/* Auto-save often */
setInterval(saveGame, 5000);

/* Load and start */
loadGame();
updateFromPrestige();
updateDisplay();

</script>
</body>
</html>
